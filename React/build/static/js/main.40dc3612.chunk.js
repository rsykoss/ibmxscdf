(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{34:function(e,t,a){},52:function(e,t,a){e.exports=a(94)},57:function(e,t){},64:function(e,t){},65:function(e,t){},66:function(e,t){},67:function(e,t){},68:function(e,t){},69:function(e,t){},86:function(e,t,a){},94:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(14),o=a.n(c),i=a(97),s=a(98),l=(a(34),a(57),a(99)),d=a(17),m=a(51);var u=e=>{const t=Object(n.useState)(),a=Object(d.a)(t,2),r=a[0],c=a[1];return Object(n.useEffect)(()=>{m.a.load(e).then(e=>{c(e)})},[e]),r},h=a(7),p=a.n(h),g=a(30),f=a(11);var v=(e,t)=>{Object(n.useEffect)(()=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:{ideal:4096},height:{ideal:2160}}}).then(a=>{e.current.srcObject=a,e.current.onloadedmetadata=(()=>{t()})})},[t,e])};const b=e=>{const t=e.getContext("2d"),a=window.devicePixelRatio;let n=e.width/a,r=e.height/a;return{setWidth:t=>{n=t,e.style.width=t+"px",e.width=t*a},setHeight:t=>{r=t,e.style.height=t+"px",e.height=t*a},width:n,height:r,clearAll:()=>t.clearRect(0,0,n*a,r*a),clearRect:(e,n,r,c)=>t.clearRect(e*a,n*a,r*a,c*a),setFont:e=>{const n=parseInt(e,10)*a,r=e.replace(/^\d+px/,n+"px");t.font=r},setTextBaseLine:e=>{t.textBaseline=e},setStrokeStyle:e=>{t.strokeStyle=e},setLineWidth:e=>{t.lineWidth=e*a},strokeRect:(e,n,r,c)=>t.strokeRect(e*a,n*a,r*a,c*a),setFillStyle:e=>{t.fillStyle=e},measureText:e=>{const n=t.measureText(e);return{width:n.width/a,actualBoundingBoxLeft:n.actualBoundingBoxLeft/a,actualBoundingBoxRight:n.actualBoundingBoxRight/a,actualBoundingBoxAscent:n.actualBoundingBoxAscent/a,actualBoundingBoxDescent:n.actualBoundingBoxDescent/a}},fillRect:(e,n,r,c)=>t.fillRect(e*a,n*a,r*a,c*a),fillText:(e,n,r)=>t.fillText(e,n*a,r*a)}},E=e=>{const t=(100*e.score).toFixed(1);return"".concat(e.label," ").concat(t,"%")},x=(e,t)=>{const a="".concat(16,"px 'ibm-plex-sans', Helvetica Neue, Arial, sans-serif");e.setFont(a),e.setTextBaseLine("top");const n=parseInt(a,10);t.forEach(t=>{const a=t.bbox[0],r=t.bbox[1],c=t.bbox[2],o=t.bbox[3],i=E(t);e.setStrokeStyle("#0062ff"),e.setLineWidth(4),e.strokeRect(Math.round(a),Math.round(r),Math.round(c),Math.round(o)),e.setFillStyle("#0062ff");const s=e.measureText(i).width;e.fillRect(Math.round(a-2),Math.round(r-(n+8)-6),Math.round(s+16),Math.round(n+8))}),t.forEach(t=>{const a=t.bbox[0],r=t.bbox[1],c=E(t);e.setFillStyle("#ffffff"),e.fillText(c,Math.round(a-2+8),Math.round(r-(n+8)-6+4))})};var y=r.a.memo(({model:e,onPrediction:t,fit:a,mirrored:c,render:o})=>{const i=Object(n.useRef)(),s=Object(n.useRef)();v(i,()=>{l()});const l=Object(n.useCallback)(Object(f.a)(p.a.mark(function n(){var r,d,m,u,h,f,v,E,y,w,N,k;return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e.detect(i.current);case 4:r=n.sent,t&&t(r),d=i.current.offsetWidth,m=i.current.offsetHeight,u=i.current.videoWidth,h=i.current.videoHeight,f=d/u,v=m/h,E="aspectFit"===a?Math.min(f,v):Math.max(f,v),y=(d-u*E)/2,w=(m-h*E)/2,(N=b(s.current)).setWidth(d),N.setHeight(m),N.clearAll(),k=r.map(e=>{let t=e.bbox[0]*E+y;const a=e.bbox[1]*E+w,n=e.bbox[2]*E,r=e.bbox[3]*E;return c&&(t=d-t-n),Object(g.a)(Object(g.a)({},e),{},{bbox:[t,a,n,r]})}),(o||x)(N,k),requestAnimationFrame(()=>{l()});case 23:case"end":return n.stop()}},n)})),[a,c,e,t,o]);return s.current&&(s.current.style.position="absolute",s.current.style.left="0",s.current.style.top="0"),i.current&&(i.current.style.width="100%",i.current.style.height="100%",i.current.style.objectFit="aspectFit"===a?"contain":"cover",i.current.style.transform=c?"scaleX(-1)":"scaleX(1)"),r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:i}),r.a.createElement("canvas",{ref:s}))});const w=a(20).default;var N,k={majorFire:[],minorFire:[],majorFall:[],minorFall:[]};const M=e=>{for(var t in k)if(Date.now()-k[t][0]>=1e3)if(k[t].length>5){console.log(N);var a,n="";t.includes("minor")?a="Minor":(a="Major",n=B()),D(n,a),k[t]=[]}else k[t]=[];e.forEach(e=>{console.log(e.label),"Major kitchen fire"===e.label?(N="Fire",k.majorFire.push(Date.now())):"Minor kitchen fire"===e.label?(N="Fire",k.minorFire.push(Date.now())):"Major Fall"===e.label?(N="Accident",k.majorFall.push(Date.now())):"Minor Fall"===e.label&&(N="Accident",k.minorFall.push(Date.now()))}),console.log(e[0])},B=()=>{var e=document.getElementsByTagName("video")[0],t=document.getElementsByTagName("canvas")[0];return t.getContext("2d").drawImage(e,0,0,t.width,t.height),function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([n],{type:a})}(t.toDataURL("image/png"))};function D(e,t){var a=new FormData;var n=window.location.search.split("=")[1];console.log(n),a.set("deviceKey",n),a.append("image",e),a.set("severity",t),a.set("eventType",N),w({method:"post",url:"https://kampung-api.herokuapp.com/iot/report",data:a,headers:{"Content-Type":"multipart/form-data",Accept:"application/json",type:"formData"}}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}var F=()=>{const e=u("/model_web");return r.a.createElement("div",{className:"fillPage"},r.a.createElement(y,{model:e,onPrediction:M,fit:"aspectFill",mirrored:!0}))},j=a(20),T=a.n(j);a(86);const C="https://kampung-api.herokuapp.com/iot/registerDevice",S="https://kampung-api.herokuapp.com/iot/fetchAllDevices";var R=class extends n.Component{constructor(){super(),this.onChange=(e=>{console.log({[e.target.name]:e.target.value}),this.setState({[e.target.name]:e.target.value})}),this.componentDidMount=(()=>{var e=window.location.search.split("=");e=2==e.length?e[1]:"",console.log(e),T.a.get(S,{params:{id:e}}).then(e=>{this.setState({id:e.id,name:e.data.name,gender:e.data.gender,age:e.data.age,address:e.data.address,devices:e.data.devices.length>0?e.data.devices:[]})})}),this.registerDevice=(e=>(e.preventDefault(),T.a.post(C,{deviceType:"cctv",id:this.state.id}).then(e=>{this.setState(t=>({devices:t.devices.concat(e.data.newDevice)}))}),r.a.createElement("div",{className:"container"},this.renderMyDevices()))),this.state={name:"",address:"",deviceType:"",devices:[]}}renderMyDevices(){return this.state.devices?this.state.devices.map(e=>r.a.createElement("div",{className:"card size"},r.a.createElement("img",{src:e.imageURL,className:"card-img-top",alt:"..."}),r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},e.title),r.a.createElement("p",{className:"card-text"},e.description),r.a.createElement("button",{className:"btn btn-primary",onClick:()=>(function(e){window.location.href="https://kampung-api.herokuapp.com/cctv?productKey="+e})(e.deviceKey)},e.type)))):r.a.createElement("div",null)}render(){return r.a.createElement("div",{className:"bg"},r.a.createElement("div",{className:"outer"},r.a.createElement("div",{className:"card side"},r.a.createElement("form",{className:"form",style:{width:"100%"},onSubmit:this.registerDevice},r.a.createElement("label",{className:"space"},"Name:"),r.a.createElement("br",null),r.a.createElement("input",{type:"text",name:"name",placeholder:"John Tay",onChange:this.onChange}),r.a.createElement("br",null),r.a.createElement("label",{className:"space"},"Address: "),r.a.createElement("br",null),r.a.createElement("input",{type:"text",name:"address",placeholder:"NTU",onChange:this.onChange}),r.a.createElement("br",null),r.a.createElement("label",{className:"space"},"Device Type: "),r.a.createElement("br",null),r.a.createElement("select",{className:"dropdown",defaultValue:this.state.deviceType,onChange:this.onChange},r.a.createElement("option",{value:"CCTV"},"CCTV"),r.a.createElement("option",{value:"Sensor"},"Sensor")),r.a.createElement("div",{className:"space"}),r.a.createElement("button",{className:"btn btn-primary",type:"submit"},"Submit")))),r.a.createElement("div",{className:"outer box"},this.renderMyDevices()))}},A=a(44),O=Object(A.a)();class L extends n.Component{render(){return r.a.createElement(l.b,{history:O},r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/",exact:!0,component:R}),r.a.createElement(l.a,{path:"/cctv",component:F})))}}o.a.render(r.a.createElement("div",{className:"App"},r.a.createElement(i.a,{bg:"dark",variant:"dark",className:"bar",sticky:"top"},r.a.createElement(i.a.Brand,{href:"/",className:"brand"},"The Kampung Network"),r.a.createElement(s.a,{className:"mr-auto"},r.a.createElement(s.a.Link,{href:"/"},"Home")),r.a.createElement(s.a,null,r.a.createElement(s.a.Link,{className:"mr-auto",href:"#pricing"},"Log Out"))),r.a.createElement(L,null)),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.40dc3612.chunk.js.map